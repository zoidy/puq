<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Modifying Smolyak Sweeps &mdash; PUQ 2.2.2 documentation</title>
    
    <link rel="stylesheet" href="../_static/default.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '2.2.2',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <link rel="top" title="PUQ 2.2.2 documentation" href="../index.html" />
    <link rel="up" title="User’s Guide and Tutorial" href="../users_guide.html" />
    <link rel="next" title="Callbacks" href="callbacks.html" />
    <link rel="prev" title="Smolyak Sparse Grid Algorithm" href="smolyak_python.html" /> 
  </head>
  <body>

<div style="background-color: white; text-align: left; padding: 10px 10px 15px 15px">
<a href="../index.html"><img src="../_static/logo.png" border="0" alt="py4sci"/></a>
</div>

    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="callbacks.html" title="Callbacks"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="smolyak_python.html" title="Smolyak Sparse Grid Algorithm"
             accesskey="P">previous</a> |</li>
        <li><a href="../index.html">home</a>|&nbsp;</li>
        <li><a href="../search.html">search</a>|&nbsp;</li>
       <li><a href="../index.html">documentation </a> &raquo;</li>

          <li><a href="../users_guide.html" accesskey="U">User&#8217;s Guide and Tutorial</a> &raquo;</li> 
      </ul>
    </div>

      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
  <h3><a href="../index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">Modifying Smolyak Sweeps</a><ul>
<li><a class="reference internal" href="#extending">Extending</a></li>
<li><a class="reference internal" href="#modifying-parameters-reusing-response-surfaces">Modifying Parameters &amp; Reusing Response Surfaces</a></li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="smolyak_python.html"
                        title="previous chapter">Smolyak Sparse Grid Algorithm</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="callbacks.html"
                        title="next chapter">Callbacks</a></p>
  <h3>This Page</h3>
  <ul class="this-page-menu">
    <li><a href="../_sources/ug/smolyak_mod.txt"
           rel="nofollow">Show Source</a></li>
  </ul>
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="modifying-smolyak-sweeps">
<h1>Modifying Smolyak Sweeps<a class="headerlink" href="#modifying-smolyak-sweeps" title="Permalink to this headline">¶</a></h1>
<div class="section" id="extending">
<h2>Extending<a class="headerlink" href="#extending" title="Permalink to this headline">¶</a></h2>
<p>If a Smolyak Sweep does not produce a good response surface, it is likely
because the polynomial level was set too low.  Fortunately we can easily
extend a previous run, increasing its level by one. This is actually very
efficient because each level uses all the information from the lower level.
So some additional jobs will run and those results will be combined with
all the previous results.  For example:</p>
<div class="highlight-python"><div class="highlight"><pre>~/puq/examples/rosen&gt; puq extend sweep_140682290.hdf5
Extending sweep_140682290.hdf5 using Smolyak
Extending Smolyak to level 4

Processing &lt;HDF5 dataset &quot;z&quot;: shape (65,), type &quot;&lt;f8&quot;&gt;
        Surface   = 100.0*x**4 - 200.0*x**2*y + 1.0*x**2 - 2.0*x + 100.0*y**2 + 1.0
        RMSE      = 3.96e-09 (1.10e-10 %)

SENSITIVITY:
Var      u*            dev
-----------------------------
x    5.0835e+03    6.9637e+03
y    1.9661e+03    1.7441e+03
</pre></div>
</div>
</div>
<div class="section" id="modifying-parameters-reusing-response-surfaces">
<span id="smolyak-mod"></span><h2>Modifying Parameters &amp; Reusing Response Surfaces<a class="headerlink" href="#modifying-parameters-reusing-response-surfaces" title="Permalink to this headline">¶</a></h2>
<p>Sometimes after you run a simulation, you get new information that causes you to adjust
your input parameters by a bit. Perhaps a new set of measurements allowed you to tighten
up the deviation a bit. Or maybe the mean shifted some.  If the input range has not widened significantly, the response
surface should still be valid and you can use it with your updated input PDF(s). All PUQ has
to do is sample the response surface with the updated PDF(s) to generate new output
PDF(s).</p>
<p>For example, take a look at puq/examples/test1.</p>
<div class="highlight-python"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29</pre></div></td><td class="code"><div class="highlight"><pre><span class="c">#!/usr/bin/env python</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">Example of using a UQ method with a sweep.</span>

<span class="sd">Usage: test1.py</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="kn">from</span> <span class="nn">puq</span> <span class="kn">import</span> <span class="o">*</span>

<span class="k">def</span> <span class="nf">run</span><span class="p">():</span>
    <span class="c"># Declare our parameters here</span>
    <span class="n">v0</span> <span class="o">=</span> <span class="n">Parameter</span><span class="p">(</span><span class="s">&#39;v&#39;</span><span class="p">,</span> <span class="s">&#39;velocity&#39;</span><span class="p">,</span> <span class="n">mean</span><span class="o">=</span><span class="mf">10.0</span><span class="p">,</span> <span class="n">dev</span><span class="o">=</span><span class="mf">1.5</span><span class="p">)</span>
    <span class="n">mass</span> <span class="o">=</span> <span class="n">Parameter</span><span class="p">(</span><span class="s">&#39;m&#39;</span><span class="p">,</span> <span class="s">&#39;mass&#39;</span><span class="p">,</span> <span class="n">mean</span><span class="o">=</span><span class="mi">95</span><span class="p">,</span> <span class="n">dev</span><span class="o">=</span><span class="mi">8</span><span class="p">)</span>

    <span class="c"># Which host to use</span>
    <span class="n">host</span> <span class="o">=</span> <span class="n">InteractiveHost</span><span class="p">()</span>
    <span class="c">#host = PBSHost(env=&#39;/scratch/prism/memosa/env.sh&#39;, cpus_per_node=8, walltime=&#39;2:00&#39;)</span>

    <span class="c"># select a parameter sweep method</span>
    <span class="c"># These control the parameters sent to the test program</span>
    <span class="c"># Currently the choices include Smolyak, and PSweep</span>
    <span class="c"># For Smolyak, first arg is a list of parameters and second is the level</span>
    <span class="n">uq</span> <span class="o">=</span> <span class="n">Smolyak</span><span class="p">([</span><span class="n">v0</span><span class="p">,</span> <span class="n">mass</span><span class="p">],</span> <span class="mi">3</span><span class="p">)</span>

    <span class="c"># If we create a TestProgram object, we can add a description</span>
    <span class="c"># and the plots will use it.</span>
    <span class="n">prog</span> <span class="o">=</span> <span class="n">TestProgram</span><span class="p">(</span><span class="s">&#39;./test1_prog.py&#39;</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s">&#39;Test Program One.&#39;</span><span class="p">)</span>

    <span class="c"># Create a Sweep object</span>
    <span class="k">return</span> <span class="n">Sweep</span><span class="p">(</span><span class="n">uq</span><span class="p">,</span> <span class="n">host</span><span class="p">,</span> <span class="n">prog</span><span class="p">)</span>
</pre></div>
</td></tr></table></div>
<p>Run it to generate the response surface:</p>
<div class="highlight-python"><div class="highlight"><pre>~/puq/examples/test1&gt; puq start test1
Saving run to sweep_145215760.hdf5

Processing &lt;HDF5 dataset &quot;kinetic_energy&quot;: shape (29,), type &quot;&lt;f8&quot;&gt;
        Surface   = 0.5*m*v**2
        RMSE      = 4.15e-08 (3.53e-10 %)

SENSITIVITY:
Var      u*            dev
-----------------------------
v    8.7761e+03    3.0974e+03
m    2.7263e+03    1.6263e+03
~/puq/examples/test1&gt; mv sweep_145215760.hdf5 test1.hdf5
</pre></div>
</div>
<p>Later you want to recompute the output with new input PDFs. You will need to put the
new Parameters in a file, with the same names (the first arg to <em>Parameter</em>). For example,</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">puq</span> <span class="kn">import</span> <span class="o">*</span>

<span class="n">v</span> <span class="o">=</span> <span class="n">Parameter</span><span class="p">(</span><span class="s">&#39;v&#39;</span><span class="p">,</span> <span class="s">&#39;velocity&#39;</span><span class="p">,</span> <span class="n">mean</span><span class="o">=</span><span class="mf">11.0</span><span class="p">,</span> <span class="n">dev</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">m</span> <span class="o">=</span> <span class="n">Parameter</span><span class="p">(</span><span class="s">&#39;m&#39;</span><span class="p">,</span> <span class="s">&#39;mass&#39;</span><span class="p">,</span> <span class="n">mean</span><span class="o">=</span><span class="mf">105.0</span><span class="p">,</span> <span class="n">dev</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
</pre></div>
</div>
<p>Then you do &#8216;puq plot &#8211;using filename&#8217;:</p>
<div class="highlight-python"><div class="highlight"><pre>/puq/examples/test1&gt; puq plot --using new_pdfs.py  test1.hdf5
plotting PDF for kinetic_energy
REPLACING
        NormalParameter m (mass)
        PDF [63.9 - 126] 100 intervals
    mean=95  dev=7.99  mode=94.7
WITH
        NormalParameter m (mass)
        PDF [85.5 - 124] 100 intervals
    mean=105  dev=5  mode=105

REPLACING
        NormalParameter v (velocity)
        PDF [4.16 - 15.8] 100 intervals
    mean=10  dev=1.5  mode=9.94
WITH
        NormalParameter v (velocity)
        PDF [7.11 - 14.9] 100 intervals
    mean=11  dev=0.999  mode=11
</pre></div>
</div>
<p>test2.py is test1.py updated with the new parameters.  You can do &#8216;puq start&#8217; on it and compute a new response surface and PDF
from scratch.  It should match the one from test1 using the new parameters.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">PDFs are plotted by sampling the response surface with random numbers generated by the input PDFs.  The resulting plot has some minor variances due to the randomness of the inputs.</p>
</div>
<div class="figure align-left">
<a class="reference internal image-reference" href="../_images/test1.png"><img alt="../_images/test1.png" src="../_images/test1.png" style="width: 500px;" /></a>
<p class="caption"><strong>PDF from test1.py</strong></p>
</div>
<div class="figure align-left">
<a class="reference internal image-reference" href="../_images/test1_new.png"><img alt="../_images/test1_new.png" src="../_images/test1_new.png" style="width: 500px;" /></a>
<p class="caption"><strong>PDF from test1 &#8211;using new_pdfs.py</strong></p>
</div>
<div class="figure align-right">
<a class="reference internal image-reference" href="../_images/test2.png"><img alt="../_images/test2.png" src="../_images/test2.png" style="width: 500px;" /></a>
<p class="caption"><strong>PDF from test2.py.</strong></p>
</div>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="callbacks.html" title="Callbacks"
             >next</a> |</li>
        <li class="right" >
          <a href="smolyak_python.html" title="Smolyak Sparse Grid Algorithm"
             >previous</a> |</li>
        <li><a href="../index.html">home</a>|&nbsp;</li>
        <li><a href="../search.html">search</a>|&nbsp;</li>
       <li><a href="../index.html">documentation </a> &raquo;</li>

          <li><a href="../users_guide.html" >User&#8217;s Guide and Tutorial</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
        &copy; Copyright 2014, Martin Hunt, Purdue University.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.2.1.
    </div>
  </body>
</html>